var $={},PIXI={},Box2D={},Boplex={};!function(n){function t(n){var t=/function (.{1,})\(/,o=t.exec(n);return o&&o.length>1?o[1]:""}function o(n,t,o){n[o]=t}function e(n,t){return n.prototype=Object.create(t.prototype),n.prototype.constructor=n,n}function i(n){n=n||new Date;var t=n.getFullYear()+"."+(n.getMonth()+1)+"."+n.getDate()+"_"+n.getHours()+":"+n.getMinutes()+":"+n.getSeconds();return t}function r(n,t,o){Object.defineProperty(n,t,{writable:!1,value:o})}function c(n,t){return n+Math.round(Math.random()*(t-n))}function a(n){n.getFuncName=t,n.defineConstProp=r,n.include=o,n.inherit=e,n.getLogTime=i,n.random=c}var u="0.0.3";r(n,"Version",u),a(n)}(Boplex),function(n){"use strict";function t(){"obsolete"}function o(n){n.BaseObject=t}o(n)}(Boplex),function(n){"use strict";function t(o){var e=o;t.prototype.log=function(t){console.log(n.getLogTime()+" "+e+" "+t)}}function o(n){n.Logger=t}o(n)}(Boplex),function(n){"use strict";function t(n,o){var e=n,i=o;t.prototype.raise=function(n){i&&i(e,n)}}function o(n){n.Event=t}o(n)}(Boplex);var FunnyRain={};!function(n){Boplex.defineConstProp(n,"Version","0.0.1"),n.Physics={},n.Graphics={},n.Plugins={},n.Plugins.Blocks={},n.Plugins.FallingThings={}}(FunnyRain),function(n){"use strict";function t(o){function e(t){d=new n.Physics.RainWorld({onDestroyBody:s}),p=new n.Graphics.View,B=new n.Plugins.PluginManager(t),$(f).length>0&&($(f).append(p.getView()),y=new n.Graphics.AnimFrame(u,l),$(document).on("dblclick touchstart",i))}function i(n){if(!g)return void c();var t=r(n.clientX,n.clientY);(!t||t&&h)&&a(),t&&t.onDblClick&&t.onDblClick(n)}function r(n,t){var o=d,e=o.findBody(n,t);return e?e.block:null}function c(){g=!0,h=!1,d.setIsPaused(!1),B.enable(!0)}function a(){h=!h,d.setIsPaused(!d.getIsPaused())}function u(n,t,o){p.setScale(n,t,o)}function l(){d.step(),B.step(),p.step()}function s(n,t){var o=t.block;o&&o.onDestroy&&o.onDestroy()}var f=o,y=null,p=null,d=null,g=!1,h=!1,B=null;e(this),t.prototype.getPluginManager=function(){return B},t.prototype.getView=function(){return p},t.prototype.getRainWorld=function(){return d},function(){B.load(),c()}()}n.Game=t}(FunnyRain),function(n){"use strict";function t(n){function o(){var n=new Box2D.Common.Math.b2Vec2(v.gravity.x,v.gravity.y);h=new Box2D.Dynamics.b2World(n,!0)}function e(n){return n/v.RATIO}function i(n){var t={width:50,height:50,x:0,y:-60,restitution:.3,friction:10,density:1},o=$.extend({},t,n),i=new Box2D.Dynamics.b2BodyDef;i.type=Box2D.Dynamics.b2Body.b2_dynamicBody,i.position.Set(e(o.x),e(o.y));var r=h.CreateBody(i),c=new Box2D.Dynamics.b2FixtureDef;return c.shape=new Box2D.Collision.Shapes.b2PolygonShape,c.shape.SetAsBox(e(o.width),e(o.height)),c.density=o.density,c.restitution=o.restitution,c.friction=o.friction,r.CreateFixture(c),r}function r(n,t,o,e){var i=new Box2D.Dynamics.b2BodyDef;i.position.Set(n,t);var r=h.CreateBody(i),c=new Box2D.Dynamics.b2FixtureDef;return c.shape=new Box2D.Collision.Shapes.b2PolygonShape,c.shape.SetAsBox(o,e),c.density=1,r.CreateFixture(c),r}function c(){var n={timeStep:1/60,velocityIterations:8,positionIterations:4},t=n.timeStep;b&&(t=0),h.Step(t,n.velocityIterations,n.positionIterations),h.DrawDebugData(),h.ClearForces(),s()}function a(n){b=n}function u(){return b}function l(){return v.RATIO}function s(){m.forEach(function(n){h.DestroyBody(n)}),m=[]}function f(n){new Boplex.Event(null,x).raise(n),m.push(n)}function y(n,t){var o=new Box2D.Collision.b2AABB;return o.lowerBound.Set(n.x-t,n.y-t),o.upperBound.Set(n.x+t,n.y+t),o}function p(n,t){var o={size:v.bodySize},e=n.GetPosition();return t.x>=e.x&&t.x<=e.x+o.size&&t.y>=e.y&&t.y<=e.y+o.size}function d(n,t){var o,i={radius:v.bodySize},r=new Box2D.Common.Math.b2Vec2(e(n),e(t)),c=y(r,e(i.radius));return h.QueryAABB(function(n){var t=n.GetBody();return t.GetType()===Box2D.Dynamics.b2Body.b2_dynamicBody&&p(t,r)?(o=t,!1):!0},c),o}function g(n,t){function o(i){for(var r=i.GetContactList();r;){var c=r.other;!c.group&&t(c,n)&&(e.push(c),c.group=e,o(c)),r=r.next}}var e=[n];return n.group=e,o(n),e}var h,B=(new Boplex.Logger("FunnyRain.Physics.BaseWorld"),{RATIO:50,gravity:{x:0,y:0},onDestroyBody:null}),v=$.extend({},B,n),m=[],x=v.onDestroyBody,b=!1;o(),t.prototype.b2m=function(n){return e.call(this,n)},t.prototype.getBox2dWorld=function(){return h},t.prototype.setIsPaused=function(n){a.call(this,n)},t.prototype.getIsPaused=function(){return u.call(this)},t.prototype.step=function(){c.call(this)},t.prototype.getScale=function(){return l.call(this)},t.prototype.createWall=function(n,t,o,e){return r.call(this,n,t,o,e)},t.prototype.createDynamicBody=function(n){return i.call(this,n)},t.prototype.findBody=function(n,t){return d.call(this,n,t)},t.prototype.destroyBody=function(n){return f.call(this,n)},t.prototype.getMatchGroup=function(n,t){return g.call(this,n,t)}}n.Physics.BaseWorld=t}(FunnyRain),function(n){"use strict";function t(o){function e(n){i(n)}function i(n){var t={wallSize:10,bottomPadding:100,leftPadding:0,rightPadding:100},o=n.b2m,e=n.createWall;e(0,o(a.canvasSize.y-t.bottomPadding),o(a.canvasSize.x),o(t.wallSize)),e(o(t.leftPadding),0,o(t.wallSize),o(a.canvasSize.y)),e(o(a.canvasSize.x-t.rightPadding),0,o(t.wallSize),o(a.canvasSize.y))}function r(n,t){var o={width:a.bodySize,height:a.bodySize,x:t||0,y:-60,restitution:.3,friction:10,density:1},e=n.createDynamicBody(o);return e}var c={canvasSize:{x:1600,y:1200},gravity:{x:0,y:9.8},bodySize:50},a=$.extend({},c,o);n.Physics.BaseWorld.call(this,a),e(this),t.prototype.createBody=function(n){return r.call(this,this,n)}}n.Physics.RainWorld=Boplex.inherit(t,n.Physics.BaseWorld)}(FunnyRain),function(n){"use strict";function t(n,t,o){function e(){var n=$(window).innerWidth(),t=$(window).innerHeight();r(n,t)}function i(){requestAnimationFrame(i),a()}function r(n,t){var o=1,e=l.canvasSize,i=n/e.x,r=t/e.y;o=i>1||r>1?1:r>i?i:r;var a=o*e.x,u=o*e.y;c(o,a,u)}var c=n,a=t,u=(new Boplex.Logger("FunnyRain.AnimFrame"),{canvasSize:{x:1600,y:1200},dpr:window.devicePixelRatio}),l=$.extend({},u,o);!function(){i(),$(window).on("resize deviceOrientation",e),$(window).trigger("resize")}(),window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(n){window.setTimeout(n,1e3/60)}}()}n.Graphics.AnimFrame=t}(FunnyRain),function(n){"use strict";function t(n){function o(n){var t=g.assetsDir+n+".png";return t}function e(){y=PIXI.autoDetectRenderer(g.canvasSize.x,g.canvasSize.y,{backgroundColor:g.backgroundColor}),p=c(g.backgroundImage),i()}function i(){}function r(n){var t=o(n),e=new PIXI.Sprite.fromImage(t);return e}function c(n){var t=r(n),o=new PIXI.Container;return o.addChild(t),o.sprite=t,o}function a(n){var t=c(n);return p.addChild(t),t}function u(n){if(n){var t=n.parent;t&&t.removeChild(n)}}function l(){return y.view}function s(n,t,o){p.scale.x=p.scale.y=n,y.resize(t,o)}function f(){y.render(p)}var y,p,d=(new Boplex.Logger("FunnyRain.Graphics.View"),{canvasSize:{x:1600,y:1200},backgroundColor:1087931,assetsDir:"assets/",backgroundImage:"background"}),g=$.extend({},d,n);e(),t.prototype.step=function(){f.call(this)},t.prototype.setScale=function(n,t,o){s.call(this,n,t,o)},t.prototype.getView=function(){return l.call(this)},t.prototype.createActor=function(n){return a.call(this,n)},t.prototype.destroyActor=function(n){return u.call(this,n)}}n.Graphics.View=t}(FunnyRain),function(n){"use strict";function t(o){function e(){var n=i();f=f.concat(n)}function i(){var t=[new n.Plugins.Blocks.BlocksPlugin(s),new n.Plugins.FallingThings.FallingThingsPlugin(s)];return t}function r(n,t){for(var o=f.length,e=n?0:o-1,i=null;!i&&e>-1&&o>e;)i=t(f[e]),e=n?e+1:e-1;return i}function c(){r(!0,function(n){n.load&&n.load()})}function a(){r(!0,function(n){n.step&&n.step()})}function u(n){r(n,function(t){t.enable&&t.enable(n)})}function l(n){var t=r(!1,function(t){return n===t.getPluginId()?t:void 0});return t}var s=o,f=[];e(),t.prototype.load=function(){c.call(this)},t.prototype.step=function(){a.call(this)},t.prototype.enable=function(n){u.call(this,n)},t.prototype.findPlugin=function(n){return l.call(this,n)}}n.Plugins.PluginManager=t}(FunnyRain),function(n){"use strict";function t(n,o){function e(n){return n._id}function i(){return r}this._id=n;var r=o;t.prototype.getPluginId=function(){return e.call(this,this)},t.prototype.getGame=function(){return i.call(this)}}n.Plugins.BasePlugin=t}(FunnyRain),function(n){"use strict";function t(o){function e(t){i=new n.Plugins.Blocks.BlocksFactory}n.Plugins.BasePlugin.call(this,"Blocks",o);var i=null;e(this),t.prototype.getBlocksFactory=function(){return i}}n.Plugins.Blocks.BlocksPlugin=Boplex.inherit(t,n.Plugins.BasePlugin)}(FunnyRain),function(n){"use strict";function t(o){function e(){u=0}function i(n){for(var t=0;t<l.length;t++){var o=l[t];if(o.blockCategory===n)return o}return null}function r(n){var t=Boplex.random(0,n.blockTypes.length-1),o=++u,e=new n.blockClass(o,n.blockTypes[t],n.blockCategory);return f.push(e),e}function c(n){var t=i(n);if(!t)throw new RangeError(n+" - unknown block category");return r(t)}function a(n){for(var t=0;t<f.length;t++)if(n===f[t]){f.splice(t,1);break}}var u,l=[{blockCategory:"fruit",blockClass:n.Plugins.Blocks.FruitBlock,blockTypes:["apple","peach","orange"]},{blockCategory:"bomb",blockClass:n.Plugins.Blocks.BombBlock,blockTypes:["bomb"]}],s={},f=($.extend({},s,o),[]);e(),t.prototype.createBlockByCategory=function(n){return c.call(this,n)},t.prototype.forEach=function(n){f.forEach(n)},t.prototype.destroyBlock=function(n){a.call(this,n)}}n.Plugins.Blocks.BlocksFactory=t}(FunnyRain),function(n){"use strict";function t(n,o,e,i){function r(n,t,o,e,i,r){B=t,v=o,m=e,n.body=v.createBody(i),n.body.block=n,n.actor=m.createActor(n.type),n.adjust(),n.scheduleDestroy()}function c(n){var t=.2;n.actor.scale.x=n.actor.scale.y=t}function a(n){var t={lifeTimeMin:1e4,lifeTimeMax:5e4},o=Boplex.random(t.lifeTimeMin,t.lifeTimeMax);n.timeout=setTimeout(function(){if(B.getIsEnabled()){if(n.timeout=null,v.getIsPaused())return void a(n);v.destroyBody(n.body)}},o)}function u(n){l(n),s(n),new Boplex.Event(n,x).raise(n)}function l(n){var t=n.timeout;t&&clearTimeout(t)}function s(n){n.actor&&(m.destroyActor(n.actor),n.actor=null)}function f(n){if(n.body&&n.actor){var t=v.getScale(),o=n.body.GetPosition();n.actor.position.x=o.x*t,n.actor.position.y=o.y*t}}function y(n,t){p(n,t)}function p(n,t){n.isResolved;n.isResolved=!0;var o=d(n,t);o.forEach(function(n){v.destroyBody(n)})}function d(n,t){return v.getMatchGroup(n.body,function(t){return t.block?n.compareGroup(t.block):void 0})}function g(n,t){return n.type===t.type}var h={};$.extend({},h,i);this.type=o;this.body=null,this.actor=null;var B,v,m;this.timeout;var x;t.prototype.install=function(n,t,o,e){r.call(this,this,n,t,o,e)},t.prototype.adjust=function(){c.call(this,this)},t.prototype.adjust=function(){c.call(this,this)},t.prototype.scheduleDestroy=function(){a.call(this,this)},t.prototype.onDestroy=function(){u.call(this,this)},t.prototype.step=function(){f.call(this,this)},t.prototype.onDblClick=function(n){y.call(this,this,n)},t.prototype.compareGroup=function(n){return g.call(this,this,n)}}n.Plugins.Blocks.BaseBlock=t}(FunnyRain),function(n){"use strict";function t(n,t,o,e){function i(n){n.scale=.2}var r={},c=$.extend({},r,e);FunnyRain.Plugins.Blocks.BaseBlock.call(this,n,t,o,c),i(this)}FunnyRain.Plugins.Blocks.FruitBlock=Boplex.inherit(t,FunnyRain.Plugins.Blocks.BaseBlock)}(FunnyRain.Plugins.Blocks),function(n){"use strict";function t(o,e,i,r){function c(n){n.actor.scale.x=n.actor.scale.y=.2,n.actor.sprite.rotation=-.05,TweenMax.to(n.actor.sprite,.1,{rotation:.05,yoyo:!0,repeat:-1}),TweenMax.to(n.actor.scale,.15,{x:.18,yoyo:!0,repeat:-1}),TweenMax.to(n.actor.scale,.15,{y:.18,yoyo:!0,repeat:-1})}var a={},u=$.extend({},a,r);n.Plugins.Blocks.BaseBlock.call(this,o,e,i,u),t.prototype.adjust=function(){c.call(this,this)}}n.Plugins.Blocks.BombBlock=Boplex.inherit(t,n.Plugins.Blocks.BaseBlock)}(FunnyRain),function(n){"use strict";function t(o){function e(t){i=new n.Plugins.FallingThings.FallManager(t.getGame())}n.Plugins.BasePlugin.call(this,"FallingThings",o);var i=null;e(this),t.prototype.load=function(){i.load()},t.prototype.getFallManager=function(){return i},t.prototype.enable=function(n){i.enable(n)},t.prototype.step=function(){i.step()}}n.Plugins.FallingThings.FallingThingsPlugin=Boplex.inherit(t,n.Plugins.BasePlugin)}(FunnyRain),function(n){"use strict";function t(n){function o(){}function e(){f=p.getRainWorld(),y=p.getView();var n=p.getPluginManager().findPlugin("Blocks");s=n.getBlocksFactory()}function i(){var n={bomb:25,max:100},t=Boplex.random(0,n.max);return t<n.bomb?"bomb":"fruit"}function r(n,t){var o=i(),e=s.createBlockByCategory(o);e.install(n,f,y,t,function(n,t){s.destroyBlock(t)})}function c(n){var t={fallWidth:1200,leftPadding:50,nextTimeMin:500,nextTimeMax:1e3},o=t.leftPadding+Boplex.random(0,t.fallWidth),e=Boplex.random(t.nextTimeMin,t.nextTimeMax);l&&(f.getIsPaused()||r(n,o),setTimeout(function(){c(n)},e))}function a(n,t){t!==l&&(l=t,l&&c(n))}function u(){s&&s.forEach(function(n){n.step()})}var l,s,f,y,p=n;o(),t.prototype.load=function(n){e.call(this)},t.prototype.enable=function(n){a.call(this,this,n)},t.prototype.getIsEnabled=function(){return l},t.prototype.step=function(){u.call(this)}}n.Plugins.FallingThings.FallManager=t}(FunnyRain),console.log("Testing FunnyRain... "),console.dir(FunnyRain);var game=new FunnyRain.Game;console.log("Test completed!");