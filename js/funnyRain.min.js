"use strict";var FunnyRain={};!function(n){Boplex.defineConstProp(n,"Version","0.0.1"),n.Physics={},n.Graphics={}}(FunnyRain),function(n){function t(t){function e(){f=new n.Physics.RainWorld({onDestroyBody:s}),l=new n.Graphics.View,$(y).append(l.getView()),d=new n.Graphics.AnimFrame(c,u),$(document).on("dblclick touchstart",i)}function i(n){if(!p)return void r();var t=o(n.clientX,n.clientY);(!t||t&&h)&&a(),t&&t.onDblClick&&t.onDblClick(n)}function o(n,t){var e=f,i=e.findBody(n,t);return i.block}function r(){p=!0,h=!1,f.setIsPaused(!1)}function a(){h=!h,f.setIsPaused(!f.getIsPaused())}function c(n,t,e){l.setScale(n,t,e)}function u(){f.step(),l.step()}function s(n,t){}var y=t,d=null,l=null,f=null,p=!1,h=!1;e()}n.Game=t}(FunnyRain),function(n){function t(n){function e(){var n=new Box2D.Common.Math.b2Vec2(x.gravity.x,x.gravity.y);w=new Box2D.Dynamics.b2World(n,!0)}function i(n){return n/x.RATIO}function o(n){var t={width:50,height:50,x:0,y:-60,restitution:.3,friction:10,density:1},e=$.extend({},t,n),o=new Box2D.Dynamics.b2BodyDef;o.type=Box2D.Dynamics.b2Body.b2_dynamicBody,o.position.Set(i(e.x),i(e.y));var r=w.CreateBody(o),a=new Box2D.Dynamics.b2FixtureDef;return a.shape=new Box2D.Collision.Shapes.b2PolygonShape,a.shape.SetAsBox(i(e.width),i(e.height)),a.density=e.density,a.restitution=e.restitution,a.friction=e.friction,r.CreateFixture(a),r}function r(n,t,e,i){var o=new Box2D.Dynamics.b2BodyDef;o.position.Set(n,t);var r=w.CreateBody(o),a=new Box2D.Dynamics.b2FixtureDef;return a.shape=new Box2D.Collision.Shapes.b2PolygonShape,a.shape.SetAsBox(e,i),a.density=1,r.CreateFixture(a),r}function a(){var n={timeStep:1/60,velocityIterations:8,positionIterations:4},t=n.timeStep;g&&(t=0),w.Step(t,n.velocityIterations,n.positionIterations),w.DrawDebugData(),w.ClearForces(),y()}function c(n){g=n}function u(){return g}function s(){return x.RATIO}function y(){m.forEach(function(n){w.DestroyBody(n)}),m=[]}function d(n){new Boplex.Event(null,B).raise(n),m.push(n)}function l(n,t){var e=new Box2D.Collision.b2AABB;return e.lowerBound.Set(n.x-t,n.y-t),e.upperBound.Set(n.x+t,n.y+t),e}function f(n,t){var e={size:x.bodySize},i=n.GetPosition();return t.x>=i.x&&t.x<=i.x+e.size&&t.y>=i.y&&t.y<=i.y+e.size}function p(n,t){var e,o={radius:x.bodySize},r=new Box2D.Common.Math.b2Vec2(i(n),i(t)),a=l(r,i(o.radius));return w.QueryAABB(function(n){var t=n.GetBody();return t.GetType()===Box2D.Dynamics.b2Body.b2_dynamicBody&&f(t,r)?(e=t,!1):!0},a),e}function h(n,t){function e(o){for(var r=o.GetContactList();r;){var a=r.other;!a.group&&t(a,n)&&(i.push(a),a.group=i,e(a)),r=r.next}}var i=[n];return n.group=i,e(n),i}var w,v=(new Boplex.Logger("FunnyRain.Physics.BaseWorld"),{RATIO:50,gravity:{x:0,y:0},onDestroyBody:null}),x=$.extend({},v,n),m=[],B=x.onDestroyBody,g=!1;e(),t.prototype.b2m=function(n){return i.call(this,n)},t.prototype.getBox2dWorld=function(){return w},t.prototype.setIsPaused=function(n){c.call(this,n)},t.prototype.getIsPaused=function(){return u.call(this)},t.prototype.step=function(){a.call(this)},t.prototype.getScale=function(){return s.call(this)},t.prototype.createWall=function(n,t,e,i){return r.call(this,n,t,e,i)},t.prototype.createDynamicBody=function(n){return o.call(this,n)},t.prototype.findBody=function(n,t){return p.call(this,n,t)},t.prototype.destroyBody=function(n){return d.call(this,n)},t.prototype.getMatchGroup=function(n,t){return h.call(this,n,t)}}n.Physics.BaseWorld=t}(FunnyRain),function(n){function t(e){function i(n){o(n)}function o(n){var t={wallSize:10,bottomPadding:100,leftPadding:0,rightPadding:100},e=n.b2m,i=n.createWall;i(0,e(c.canvasSize.y-t.bottomPadding),e(c.canvasSize.x),e(t.wallSize)),i(e(t.leftPadding),0,e(t.wallSize),e(c.canvasSize.y)),i(e(c.canvasSize.x-t.rightPadding),0,e(t.wallSize),e(c.canvasSize.y))}function r(n,t){var e={width:c.bodySize,height:c.bodySize,x:t||0,y:-60,restitution:.3,friction:10,density:1},i=n.createDynamicBody(e);return i}var a={canvasSize:{x:1600,y:1200},gravity:{x:0,y:9.8},bodySize:50},c=$.extend({},a,e);n.Physics.BaseWorld.call(this,c),i(this),t.prototype.createBody=function(n){return r.call(this,this,n)}}n.Physics.RainWorld=Boplex.inherit(t,n.Physics.BaseWorld)}(FunnyRain),function(n){function t(n,t,e){function i(){var n=$(window).innerWidth(),t=$(window).innerHeight();r(n,t)}function o(){requestAnimationFrame(o),c()}function r(n,t){var e=1,i=s.canvasSize,o=n/i.x,r=t/i.y;e=o>1||r>1?1:r>o?o:r;var c=e*i.x,u=e*i.y;a(e,c,u)}var a=n,c=t,u=(new Boplex.Logger("FunnyRain.AnimFrame"),{canvasSize:{x:1600,y:1200},dpr:window.devicePixelRatio}),s=$.extend({},u,e);!function(){o(),$(window).on("resize deviceOrientation",i),$(window).trigger("resize")}(),window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(n){window.setTimeout(n,1e3/60)}}()}n.Graphics.AnimFrame=t}(FunnyRain),function(n){function t(n){function e(n){var t=h.assetsDir+n+".png";return t}function i(){l=PIXI.autoDetectRenderer(h.canvasSize.x,h.canvasSize.y,{backgroundColor:h.backgroundColor}),f=a(h.backgroundImage),o()}function o(){}function r(n){var t=e(n),i=new PIXI.Sprite.fromImage(t);return i}function a(n){var t=r(n),e=new PIXI.Container;return e.addChild(t),e.sprite=t,e}function c(n){var t=a(n);return f.addChild(t),t}function u(n){if(n){var t=n.parent;t&&t.removeChild(n)}}function s(){return l.view}function y(n,t,e){f.scale.x=f.scale.y=n,l.resize(t,e)}function d(){l.render(f)}var l,f,p=(new Boplex.Logger("FunnyRain.Graphics.View"),{canvasSize:{x:1600,y:1200},backgroundColor:1087931,assetsDir:"assets/",backgroundImage:"background"}),h=$.extend({},p,n);i(),t.prototype.step=function(){d.call(this)},t.prototype.setScale=function(n,t,e){y.call(this,n,t,e)},t.prototype.getView=function(){return s.call(this)},t.prototype.createActor=function(n){return c.call(this,n)},t.prototype.destroyActor=function(n){return u.call(this,n)}}n.Graphics.View=t}(FunnyRain);